{% extends 'layouts/base_app.html' %}
{% load widget_tweaks %}
{% load safe_js %}

{% load static %}

{% block head %}
{{block.super}}
<link rel="stylesheet" href="{% static 'css/bootstrap-select.min.css' %}">

{% endblock head %}


{% block content %}
{{block.super}}
<div class="page-content" id="content">
    <h1>
        {% if editing %}
            Editando Venta
        {% else %}
            Creando Venta
        {% endif %}
    </h1>
    <form action="" method="POST">
        {% csrf_token %}
        <input type="hidden" name="company" value="{{company.pk}}" >
        {% if not user.is_superuser %}
            <input type="hidden" name="company_user" value="{{company_user.pk}}" >

        {% endif %}
        {{form.raw_materials.label_tag}}
        <p> {% render_field form.raw_materials class+="selectpicker col-8 mx-4" multiple="" v-model="materials" data-live-search="true" title="Escoge los proveedores" %}</p>
        <div >
            <div v-for="(item, index) in selected_materials()" :key="index">
                <p>
                    [[item.name]]
                </p>
                <input type="text" v-model="item.hello">
                <p>[[item.hello]]</p>
            </div>

        </div>

        {{form.total_cost_dollar.label_tag}}
        <p> {% render_field form.total_cost_dollar%}</p>
        {{form.total_cost_local.label_tag}}
        <p> {% render_field form.total_cost_local%}</p>

        <input type="hidden" name="sold_materials[]" >
    </form>

</div>

{% endblock content %}

{% block javascript %}
    {{block.super}}
    <script src="{% static 'js/bootstrap_select/bootstrap-select.min.js' %}"></script>
<script>
var app = new Vue({
    delimiters: ['[[', ']]'],
    el: '#app',
    data: {
        materials: [],
        raw_materials: {{ raw_materials | safe }},
        // selected_materials: [],
    },
    methods: {
        selected_materials: function() {
            let selected = Array(this.materials.length)
            let self = this;
            for (let i = 0; i < this.materials.length; i++) {
                selected[i] = this.raw_materials.find(function(el) {
                    return el.pk === parseInt(self.materials[i]);
                });
            }
            return selected
        },
    }
});

</script>
{% endblock javascript %}